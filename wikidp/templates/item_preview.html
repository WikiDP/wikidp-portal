{% extends "item.html" %}

{% block item_content %}
    <!-- preview page specific -->
	<div id="preview-div">
        <div id="header-text">
            <span id="preview-item-name">
                <span class="qlabel" its-ta-ident-ref="{{item.qid | entity_url}}">
                    {{item.label}}
                </span>
                <a class="wd-id" href="{{item.qid | entity_url}}" target="_blank">
                    ({{item.qid}})
                </a>
            </span>
            <br>
            {% if item.description %}
                <span id="preview-item-description" title="{{item.description}}">
                    {{item.description}}
                </span>
            {% endif %}
            <div id="languageSelectDiv">
                Language:
                <select name="" id="languageSelect"  aria-label="Select a Language for Item Labels">
                    <option value="en">English</option>
                    <option value="fr">French</option>
                    <option value="es">Spanish</option>
                </select>
            </div>
        </div>
        <div id="claims-div">
            <div class="table-header-div">
                <span class="tbl-cat">
                        Current Data About <span class="qlabel" its-ta-ident-ref="{{item.qid | entity_url}}">{{item.label}}</span>
                    </span></div>
                    <div id="claims-scroller" class="scroller">

                        <table  class="table claims-table table-responsive table-striped table-hover">
                    {% for clm in item.claims %}
                        <tr data-pid="{{clm.pid}}">
                            <td class="invert-col">
                                {{ clm.label }}
                                <a target="_blank" href="{{clm.pid | entity_url}}" class="">
                                    ({{clm.pid}})
                                </a>
                            </td>
                            <td>
                                {% for sub in clm['values'] %}
                                    <span class="detail-row">
                                        {% if sub.parse_type == 'item' %}
                                            <span class="qlabel" its-ta-ident-ref="{{sub.value | entity_url}}">
                                                {{sub.value}}
                                            </span>
                                            <a href="/{{sub.value}}" class="p_or_q_id">
                                                ({{ sub.value }})
                                            </a>
                                        {% elif sub.parse_type == 'property' %}
                                            {{ sub.value }}
                                            <a target="_blank" href="{{sub.value.pid | entity_url}}" class="">
                                                ({{sub.value.label}})
                                            </a>
                                        {% elif sub.parse_type == 'url'  %}
                                            <a target="_blank" href="{{sub.value}}">{{sub.value}}</a>
                                        {% elif sub.parse_type == 'image'  %}
                                            <a target="_blank" href="{{sub.value}}">
                                                <img class="property-image" src="{{sub.value}}" style="border:0;" width="80%" alt="image for {{item.label}}">
                                            </a>
                                        {% else %}
                                            {{ sub.value }}
                                        {% endif %}
                                        {% with references = sub.references  %}
                                            {% include "snippets/preview_references.html" %}
                                        {% endwith %}
                                        </br>
                                    </span>
                                {% endfor %}
                            </td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
        <div id="other-info-div">
            <div class="table-header-div">
                <span class="tbl-cat">
                    other details
                </span>
            </div>
            <div id="other-info-scroller" class="scroller">
                <table class="selected-table table-responsive table-striped table-hover">
                    {%if item.aliases %}
                        <tr>
                            <td>
                                Aliases
                            </td>
                            <td>
                                {%for p in item.aliases%}
                                    {{p}}
                                {%endfor%}
                            </td>
                        </tr>
                    {%endif%}
                    {%if item.description != []%}
                        <tr>
                            <td>
                                Description
                            </td>
                            <td id="sub_description">
                                {{item.description}}
                            </td>
                        </tr>
                    {%endif%}
                </table>
                {%if item.external_links %}
                <br>

                <span class="tbl-cat">External Links </span>
                <table class="ex-links-table  table-responsive table-striped table-hover">
                    {%for ex in item.external_links %}
                        <tr>
                            <td>
                                {{ex.label}}
                                <a target="_blank" href="{{ex.pid | entity_url}}" class="">
                                    ({{ex.pid }})
                                </a>
                            </td>
                            <td>
                                {% for ex_link in ex['values']%}
                                    {% if ex_link.value.url %}
                                        <a target="_blank" href="{{ex_link.value.url }}">{{ex_link.value.label}}</a>
                                    {%else%}
                                        {{ex_link.value.label}}
                                    {%endif%}
                                {% endfor %}
                            </td>
                        </tr>
                    {%endfor%}
                </table>
                {%endif%}
                </div>

            </div>
	</div>
	<script type="text/javascript">
	var LANG = 'en';
		$(document).ready(function(){
			$('img.property-image').fadeIn(4000)
		})
		function pageTransition(form){
	  $('div#content-frame').fadeOut(500, function(
	  ){
	  $('body').append(form);
	form.submit();
	})
	}
	function sidebar_property_click(elm){
        let $elm = $(elm);
        if($elm.data('count') > 0){
            let this_pid = $elm.data('pid');
            let $scrollDiv = $(`.claims-table tr[data-pid="${this_pid}"]`);
            {#TODO: Use jQuery Animate instead of scrollIntoView #}
            $scrollDiv[0].scrollIntoView({behavior: "smooth"}, () => {
                $scrollDiv.addClass('scroll-highlight');
            setTimeout(function(){
                $scrollDiv.removeClass('scroll-highlight');
            }, 1000)
            } );

        }
		else{
			alert('There are currently no statements with this property recorded. If you know of some to add, click the contribute button to create a statement for this property.')
		}
    }
		$('select#option-select').change(function(){
			var list = $('option.item-option')
			var options = []
			for (i = 0; i < list.length; i++){
			console.log($(list[i]).data('qid'), $(list[i]).data('label'))
				options.push([$(list[i]).data('qid').replace("'","&#39;"), $(list[i]).data('label').replace("'","&#39;"), $(list[i]).data('description').replace("'","&#39;") ])
			}
			options = JSON.stringify(options)

            var form = $('<form action="/preview" method="post">' +
              '<input type="text" name="qid" value="' + $(this).val() + '" />' +
              '<input type="text" name="optionList" '+"value='"+options+"' />" +
              '</form>').hide(0);
            pageTransition(form)
                    // return $.post("/preview", {qid:qid})
                });

		$('li#contribute-action').click(function(){
			var list = $('option.item-option')
			var options = []
			for (i = 0; i < list.length; i++){
			console.log($(list[i]).data('qid'), $(list[i]).data('label'))
				options.push([$(list[i]).data('qid').replace("'","&#39;"), $(list[i]).data('label').replace("'","&#39;"), $(list[i]).data('description').replace("'","&#39;") ])
			}
			options = JSON.stringify(options)
			console.log(options)
			console.log($('div#panel-frame').data('qid'))

	var form = $('<form action="/contribute" method="post">' +
	  '<input type="text" name="qid" value="' + $('div#panel-frame').data('qid') + '" />' +
	  '<input type="text" name="optionList" '+"value='"+options+"' />" +
	  '</form>').hide(0);
	pageTransition(form)
		})
		$('.scroller').scroll(function()
		{
				$.qLabel.switchLanguage(LANG);
		});
		$('#languageSelect').change(function(){
			LANG = $('#languageSelect').val()
			$.qLabel.switchLanguage(LANG);
		})
	</script>
    <!-- end preview page specific -->
{% endblock item_content %}
